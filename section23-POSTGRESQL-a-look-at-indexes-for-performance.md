###### <div style="text-align:right">[table of contents](#table-of-contents)</div>

## Section 23 - a look at indexes for performance

## Indexes

Indexes help with performance

- without indexes, to search data the data has to be loaded up to memory (large performance cost)
- then search through all data for what we are looking for (iteration of rows) also know as 'Full table scan'
- indexes are data structures that efficiently tells us which block and index a record is stored in a heap file on harddrive.

#### how an index works?

- basically how index works is it picks a column we want to have a fast look up on.
- you can have an index on multiple columns.
- then we look at our heap file and that property we want to extract for every row and we then record the block and index and that property (column) value.
- we then sort in some meaningful way, eg. alphabetically.
- put this list of data into a binary tree
- root node gets instructions on where the new node should go eg. left or right (elimination of wrong node direction)
- we cut down the number of blocks we have to read data from.

#### creating an index

- creating an index on users table -> username column.
- view all indexes for a database -> schemas -> table -> users -> indexes -> \*(refresh) ->
- naming convention: users_username_idx

```SQL
CREATE INDEX on users (username);
```

#### deleting index

```SQL
DROP INDEX users_username_idx;
```

#### Benchmarking queries with indexes

Keyword : 'EXPLAIN ANALYZE' in front of SELECT statement
Indexes make queries run 16X faster

```SQL
EXPLAIN ANALYZE SELECT *
FROM users
WHERE username = 'Emil30';
```

#### downside of indexes

Indexes are performance benefit, however it can sometimes slow down database.
Indexes take up storage space.

```SQL
--Finding out how much space index use.
SELECT pg_size_pretty(pg_relation_size('users_username_idx'))
```

Indexes slow down insert/update/delete because index has to be updated (especially tables that get updated frequently)

Index might not get used.

#### PostgreSQL autogenerated indexes

postgres does manage its own indexes.
Idexes are created automatically by postgresql for columns (and therefore you never have to create your own indexes for these):

- primary keys
- column that has UNIQUE constraint

Query to see which indexes (relkind = i) actually exist for database

```SQL
SELECT relname, relkind
FROM pg_class
WHERE relkind = 'i'  -- type: index
```
